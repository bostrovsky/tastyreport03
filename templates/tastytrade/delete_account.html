{% extends 'base.html' %}

{% block title %}Delete Account - TastyTrade Settings{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0 text-danger">Delete TastyTrade Account</h1>
                <a href="{% url 'tastytrade_settings' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Settings
                </a>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Permanently Delete Your TastyTrade Integration
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-danger">
                        <h6 class="alert-heading">
                            <i class="fas fa-warning me-2"></i>Warning: This action cannot be undone
                        </h6>
                        <p class="mb-0">
                            Deleting your TastyTrade account integration will permanently remove all 
                            data and settings associated with your TastyTrade connection. This includes:
                        </p>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="text-danger mb-2">What will be deleted:</h6>
                            <ul class="text-muted">
                                <li>All stored TastyTrade credentials</li>
                                <li>All account preferences and settings</li>
                                <li>OAuth tokens and authentication data</li>
                                {% if not form.keep_data.value %}
                                    <li class="text-danger"><strong>All historical trading data</strong></li>
                                    <li class="text-danger"><strong>All positions and transactions</strong></li>
                                {% endif %}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-success mb-2">What will NOT be affected:</h6>
                            <ul class="text-muted">
                                <li>Your TastyTrade Tracker user account</li>
                                <li>Your actual TastyTrade brokerage account</li>
                                <li>Any data on TastyTrade's platform</li>
                                {% if form.keep_data.value %}
                                    <li class="text-success"><strong>Your historical trading data</strong></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>

                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-4">
                            <div class="form-check">
                                {{ form.keep_data }}
                                <label class="form-check-label" for="{{ form.keep_data.id_for_label }}">
                                    <strong>Keep my historical trading data for reporting purposes</strong>
                                </label>
                            </div>
                            <small class="form-text text-muted">
                                If checked, your positions and transactions will be preserved even after 
                                deleting the TastyTrade integration. You can still view historical reports, 
                                but you won't be able to sync new data until you reconnect.
                            </small>
                            {% if form.keep_data.errors %}
                                <div class="text-danger mt-1">
                                    {{ form.keep_data.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-4">
                            <label for="{{ form.confirmation.id_for_label }}" class="form-label">
                                <strong>Type "DELETE" to confirm account deletion</strong>
                            </label>
                            {{ form.confirmation }}
                            <small class="form-text text-muted">
                                You must type "DELETE" in capital letters to confirm this action.
                            </small>
                            {% if form.confirmation.errors %}
                                <div class="text-danger mt-1">
                                    {{ form.confirmation.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{% url 'tastytrade_settings' %}" class="btn btn-outline-secondary me-md-2">Cancel</a>
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash me-2"></i>Delete TastyTrade Integration
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h6 class="card-title mb-0">Need help instead of deletion?</h6>
                </div>
                <div class="card-body">
                    <p class="mb-2">If you're having issues with your TastyTrade integration, consider these alternatives:</p>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="small text-muted">
                                <li><a href="{% url 'tastytrade_change_password' %}">Update your password</a> if it changed</li>
                                <li><a href="{% url 'tastytrade_account_preferences' %}">Adjust your preferences</a> for better experience</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="small text-muted">
                                <li><a href="{% url 'tastytrade_manage_tracked_accounts' %}">Stop tracking specific accounts</a> instead of full deletion</li>
                                <li>Contact support if you're experiencing technical issues</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if messages %}
        <div class="row mt-4">
            <div class="col-12">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}